<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GM vault</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Permanent+Marker&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/app.css">
  <link rel="stylesheet" href="css/notion-markdown.css">
  <!-- Preload iconos cr√≠ticos -->
  <link rel="preload" href="img/icon-add.svg" as="image" type="image/svg+xml">
  <link rel="preload" href="img/icon-arrow.svg" as="image" type="image/svg+xml">
  <link rel="preload" href="img/folder-open.svg" as="image" type="image/svg+xml">
  <link rel="preload" href="img/folder-close.svg" as="image" type="image/svg+xml">
  <link rel="preload" href="img/icon-eye-open.svg" as="image" type="image/svg+xml">
  <link rel="preload" href="img/icon-eye-close.svg" as="image" type="image/svg+xml">
  <script>
    // Detecci√≥n temprana del modo modal para ocultar elementos innecesarios antes de que se cargue el JS
    (function() {
      const params = new URLSearchParams(window.location.search);
      if (params.get('modal') === 'true') {
        // Marcar que estamos en modo modal
        document.documentElement.classList.add('modal-mode');
      }
    })();
  </script>
  <style>
    /* Estilos para modo modal - ocultar elementos innecesarios inmediatamente */
    html.modal-mode body {
      padding: 0 !important;
      overflow: hidden !important;
    }
    html.modal-mode .container {
      max-width: 100% !important;
      height: 100vh !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    html.modal-mode #header,
    html.modal-mode #page-list,
    html.modal-mode #settings-container,
    html.modal-mode .button-container {
      display: none !important;
    }
    html.modal-mode #notion-container {
      display: block !important;
      height: 100vh !important;
      border-radius: 0 !important;
    }
    html.modal-mode #notion-container.hidden {
      display: block !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Global header -->
    <header id="header" class="header">
      <button id="back-button" class="btn btn--sm hidden">
        <img src="img/icon-arrow.svg" alt="Back" class="btn__icon">
        Back
      </button>
      <h1 id="page-title" class="header__title">GM vault</h1>
    </header>

    <!-- Page list -->
    <div id="page-list" class="page-list"></div>

    <!-- Notion container -->
    <div id="notion-container" class="notion-container hidden">
      <iframe id="notion-iframe" class="notion-container__iframe" src="" frameborder="0" allowfullscreen></iframe>
      <div id="notion-content" class="notion-container__content notion-content"></div>
    </div>

    <!-- Settings panel -->
    <div id="settings-container" class="settings hidden">
      <div class="settings__content">
        
        <div class="form">
          <div class="form__field">
            <label class="form__label" for="token-input">Notion Token</label>
            <p class="settings__description">
              Configure your Notion token <a href="https://developers.notion.com/docs/create-a-notion-integration#create-your-integration-in-notion" class="link">following this tutorial</a> to use your own pages. This token is global for the entire extension (all rooms). 
            </p>
            <input type="password" id="token-input" placeholder="ntn_... or secret_..." class="input input--mono" autocomplete="off" data-1p-ignore data-lpignore="true" data-form-type="other" spellcheck="false">
            <p id="token-masked" class="form__help"></p>
          </div>
          
          <div id="token-error" class="form__error"></div>
          
          <div class="form__actions">
            <button id="clear-token" class="btn btn--ghost btn--flex">Delete Token</button>
            <button id="save-token" class="btn btn--primary btn--flex">Save Token</button>
          </div>
          <div class="form__actions form__actions--double">
            <button id="import-notion-btn" class="btn btn--primary btn--flex">üì• Import from Notion</button>
          </div>
        </div>

        <div class="form form--separated">
          <label class="form__label">Export vault</label>
          <p class="settings__description">
            Save and reuse your GM Vault. Import a setup shared by another GM or export yours as a backup.
          </p>
          <div class="form__actions form__actions--single">
            <button id="view-json-btn" class="btn btn--ghost btn--flex hidden">View JSON</button>
          </div>
          <div class="form__actions form__actions--double">
            <button id="load-json-btn" class="btn btn--primary btn--flex">Load vault</button>
            <button id="download-json-btn" class="btn btn--ghost btn--flex">Download vault</button>
          </div>
          <div class="form__field">
            <label class="form__label" for="vault-url-input">Load vault from URL</label>
            <input type="url" id="vault-url-input" placeholder="https://example.com/gm-vault" class="input input--mono" autocomplete="off" spellcheck="false">
            <div class="form__actions form__actions--single" style="margin-top: 8px;">
              <button id="load-url-btn" class="btn btn--primary btn--flex">Load from URL</button>
            </div>
          </div>
        </div>

        <div class="form form--separated">
          <label class="form__label">Clear Local Data</label>
          <p class="settings__description">
            If you're experiencing issues with the vault, clearing local data can help resolve problems with corrupted or outdated cached data.
          </p>
          <div class="form__actions form__actions--single">
            <button id="clear-local-data-btn" class="btn btn--ghost btn--flex">üóëÔ∏è Clear Local Data</button>
          </div>
        </div>

        <div class="form form--separated">
          <label class="form__label">Feedback & Suggestions</label>
          <p class="settings__description">
            GM Vault is built and maintained in my spare time. If you find it useful, consider supporting the project on Patreon to help fund ongoing maintenance, bug fixes, and improvements. You can also share your ideas through our roadmap page.
          </p>
          <div class="form__actions form__actions--double">
            <button id="patreon-btn" class="btn btn--primary btn--flex">Support on Patreon</button>
            <button id="feedback-btn" class="btn btn--ghost btn--flex">Give Feedback</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Usar js/index.js (original) o js/main.js (modular) -->
  <!-- Para probar la versi√≥n modular, cambiar a: src="js/main.js" -->
  <script type="module" src="js/main.js"></script>
</body>
</html>

